this.Hull=this.Hull||{},this.Hull.templates=this.Hull.templates||{},this.Hull.templates._default=this.Hull.templates._default||{},Hull.templates._default["friends/list/list"]=function(i,t,e,s,r){function n(i){var t,e="";return e+='\n  <small>You need to sign in.</small>\n  <div data-hull-component="login/button@hull" data-hull-provider="'+f((t=i&&i.authorized,t=null==t||t===!1?t:t.provider_name,typeof t===m?t.apply(i):t))+'"></div>\n'}function a(i,t){var s,r="";return r+="\n  ",s=e.unless.call(i,(s=i&&i.authorized,null==s||s===!1?s:s.permissions),{hash:{},inverse:v.program(6,l,t),fn:v.program(4,o,t),data:t}),(s||0===s)&&(r+=s),r+="\n"}function o(){return"\n    You need to give permissions to show these friends.\n    <a class='btn' data-hull-action=\"authorize\">Authorize</a>\n  "}function l(i,t){var s,r="";return r+='\n    <div class="hull-friends">\n      ',s=e["if"].call(i,i&&i.friends,{hash:{},inverse:v.program(10,u,t),fn:v.program(7,h,t),data:t}),(s||0===s)&&(r+=s),r+="\n    </div>\n  "}function h(i,t){var s,r="";return r+='\n        <ul class="media-list">\n          ',s=e.each.call(i,i&&i.friends,{hash:{},inverse:v.noop,fn:v.program(8,d,t),data:t}),(s||0===s)&&(r+=s),r+="\n        </ul>\n      "}function d(i,t){var s,r,n="";return n+='\n            <li class="media">\n              <div class="pull-left">\n                <img src="',(r=e.avatar)?s=r.call(i,{hash:{},data:t}):(r=i&&i.avatar,s=typeof r===m?r.call(i,{hash:{},data:t}):r),n+=f(s)+'" alt="',(r=e.name)?s=r.call(i,{hash:{},data:t}):(r=i&&i.name,s=typeof r===m?r.call(i,{hash:{},data:t}):r),n+=f(s)+'" class="media-object img-round">\n              </div>\n              <div class="media-body">\n                <h4 class="media-heading">',(r=e.name)?s=r.call(i,{hash:{},data:t}):(r=i&&i.name,s=typeof r===m?r.call(i,{hash:{},data:t}):r),n+=f(s)+"</h4>\n              </div>\n            </li>\n          "}function u(){return'\n        <div class="alert">\n          <p>Oopsâ€¦ No friends for the moment</p>\n        </div>\n      '}this.compilerInfo=[4,">= 1.0.0"],e=this.merge(e,i.helpers),r=r||{};var p,c="",m="function",f=this.escapeExpression,v=this;return p=e.unless.call(t,(p=t&&t.authorized,null==p||p===!1?p:p.provider),{hash:{},inverse:v.program(3,a,r),fn:v.program(1,n,r),data:r}),(p||0===p)&&(c+=p),c+="\n"},Hull.component("friends/list@hull",{type:"Hull",templates:["list"],options:{id:"me",provider:"hull",limit:10,scope:""},refreshEvents:["model.hull.me.change"],initialize:function(){this.me=this.api.model("me"),this.provider=this.options.provider},getUserId:function(){return this.options.id||"me"},actions:{authorize:function(){"facebook"===this.provider?this.sandbox.login("facebook",{scope:this.options.scope}).then(this.sandbox.util._.bind(function(){this.render()},this)):this.sandbox.login(this.provider,{}).then(this.sandbox.util._.bind(function(){},this))}},datasources:{authorized:function(){return this.isAuthorized(this.provider)},friends:function(){var i=this.sandbox.data.deferred(),t=this,e=this.sandbox.util._.reduce(this.me.get("identities"),function(i,t){return i[t.provider]=t,i},{});return this.loggedIn()[this.provider]||"hull"===this.provider&&(this.loggedIn()||"me"!==this.getUserId())?this.request(this.provider,e,this.options).then(this.sandbox.util._.bind(function(e){var s=this.sandbox.util._.bind(this.serializers[t.provider],this,e,this.options),r=s().slice(0,this.options.limit);i.resolve(r)},this)):i.resolve([]),i.promise()}},isAuthorized:function(i){var t=this.sandbox.data.deferred(),e=this,s={provider_name:i,provider:!1,permissions:!1};if("hull"===i){s.permissions=!0;var r=this.loggedIn()||"me"!==this.getUserId();s.provider=r;var n=this.authServices();n&&n.length?(s.provider_name=n[0],t.resolve(s)):t.reject(new Error("No auth provider for this app")),t.resolve(s)}else this.loggedIn()[i]?(s.provider=!0,"facebook"===i?this.hasFacebookPermissions(e.options.scope,s,t):(s.permissions=!0,t.resolve(s))):(s.provider=!1,t.resolve(s));return t.promise()},hasFacebookPermissions:function(i,t,e){this.sandbox;i?this.api({provider:"facebook",path:"me/permissions"}).then(function(s){this.sandbox.util._.isString(i)&&(i=i.replace(" ","").split(",")),this.sandbox.util._.isArray(i)&&this.sandbox.util._.intersection(this.sandbox.util._.keys(s.data[0]),i).length==i.length&&(t.permissions=!0),e.resolve(t)}):(t.permissions=!0,e.resolve(t))},request:function(i,t){var e,s;switch(i){case"hull":e=this.getUserId()+"/friends",s={per_page:this.options.limit};break;case"facebook":e={provider:"facebook",path:this.getUserId()+"/friends"},s={limit:this.options.limit};break;case"twitter":e={provider:"twitter",path:"friends/list"},s={user_id:"me"===this.getUserId()?t.twitter.uid:this.getUserId()};break;case"instagram":e={provider:"instagram",path:"users/"+("me"===this.getUserId()?"self":this.getUserId())+"/follows"},s={per_page:this.options.limit};break;case"github":e={provider:"github",path:"users/"+("me"===this.getUserId()?t.github.login:this.getUserId())+"/following"},s={per_page:this.options.limit}}return this.api(e,s)},serializers:{hull:function(i){return this.sandbox.util._.map(i,function(i){return{provider:"hull",name:i.name,avatar:i.picture,uid:i.id}})},facebook:function(i){return this.sandbox.util._.map(i.data,function(i){return{provider:"facebook",name:i.name,avatar:"http://graph.facebook.com/"+i.id+"/picture",uid:i.id}})},twitter:function(i){return this.sandbox.util._.map(i.users,function(i){return{provider:"twitter",name:i.name,avatar:i.profile_image_url,uid:i.id}})},instagram:function(i){return this.sandbox.util._.map(i,function(i){return{provider:"instagram",name:i.full_name,avatar:i.profile_picture,uid:i.id}})},github:function(i){return this.sandbox.util._.map(i,function(i){return{provider:"github",name:i.login,avatar:i.avatar_url,id:i.id}})}}});