this.Hull=this.Hull||{},this.Hull.templates=this.Hull.templates||{},this.Hull.templates._default=this.Hull.templates._default||{},Hull.templates._default["login/form/form"]=function(n,t,a,e,i){function s(n,t){var e,i="";return i+="\n  ",e=a["if"].call(n,n&&n.validationErrors,{hash:{},inverse:v.program(10,d,t),fn:v.program(2,r,t),data:t}),(e||0===e)&&(i+=e),i+="\n"}function r(n,t){var e,i="";return i+='\n    <h4>Validation Errors</h4>\n    <form class="form-validations">\n\n    ',e=a["if"].call(n,(e=n&&n.validationErrors,null==e||e===!1?e:e.email),{hash:{},inverse:v.noop,fn:v.program(3,o,t),data:t}),(e||0===e)&&(i+=e),i+="\n    ",e=a["if"].call(n,(e=n&&n.validationErrors,null==e||e===!1?e:e.username),{hash:{},inverse:v.noop,fn:v.program(8,m,t),data:t}),(e||0===e)&&(i+=e),i+='\n        <button class="btn btn-lg btn-primary btn-block" type="submit">Complete my profile</button>\n    </form>\n  '}function o(n,t){var e,i="";return i+="\n      ",e=a["if"].call(n,(e=n&&n.currentUser,null==e||e===!1?e:e.email),{hash:{},inverse:v.program(6,u,t),fn:v.program(4,l,t),data:t}),(e||0===e)&&(i+=e),i+="\n    "}function l(n){var t,a="";return a+="\n      A confirmation email has been sent to "+g((t=n&&n.currentUser,t=null==t||t===!1?t:t.email,typeof t===p?t.apply(n):t))+"...\n      <a class=\"btn btn-link\" data-hull-action='resetPassword'>Oops... Looks like i did not get it, please send me another one...</a>\n      <a class=\"btn btn-link\" data-hull-action='resendConfirmation'>Can you please send me my confirmation email again ?</a>\n      "}function u(){return'\n        <h2 class="form-signin-heading">Please set your email to complete your registration</h2>\n        <input name="email" type="email" class="form-control" placeholder="Email" required autofocus>\n      '}function m(){return'\n        <h2 class="form-signin-heading">Please set your username to complete your registration</h2>\n        <input name="username" type="text" class="form-control" placeholder="Username" required autofocus>\n    '}function d(n){var t,a="";return a+="\n  Hey "+g((t=n&&n.currentUser,t=null==t||t===!1?t:t.name,typeof t===p?t.apply(n):t))+", you can <a class='btn-link' data-hull-action='logout'>Logout</a> now...\n  "}function c(){return'\n<form class="form-signin" role="form">\n  <h2 class="form-signin-heading">Please sign in</h2>\n  <input data-hull-input-login name="login" type="text" class="form-control" placeholder="Username or Email" required autofocus>\n  <input name="password" type="password" class="form-control" placeholder="Password" required>\n  <button class="btn btn-lg btn-primary btn-block" type="submit">Sign in</button>\n  <div>\n    <a class="btn btn-link"  data-hull-action=\'resetPassword\'>Oops... I think i forgot my password</a>\n    <a class="btn btn-link" data-hull-action=\'resendConfirmation\'>Can you please send me my confirmation email again ?</a>\n  </div>\n</form>\n<div data-hull-component="login/button@hull"></div>\n'}this.compilerInfo=[4,">= 1.0.0"],a=this.merge(a,n.helpers),i=i||{};var h,f="",p="function",g=this.escapeExpression,v=this;return f+='<div class="alert" data-hull-alert-message style="display:none"></div>\n',h=a["if"].call(t,t&&t.loggedIn,{hash:{},inverse:v.program(12,c,i),fn:v.program(1,s,i),data:i}),(h||0===h)&&(f+=h),f+="\n"},Hull.component("login/form@hull",{templates:["form"],refreshEvents:["model.hull.me.change"],events:{"keyup input":function(){this.alertMessage(!1)},"submit .form-signin":function(n){n.preventDefault(),this.alertMessage(!1);var t=this.sandbox.dom.getFormData(n.target);this.sandbox.login(t.login,t.password)},"submit .form-validations":function(n){n.preventDefault();var t=this,a=this.sandbox.dom.getFormData(n.target);this.api("me",a,"put").then(function(){t.render()},function(n){t.alertMessage(n.message)})}},actions:{resetPassword:function(){var n=this.$("[data-hull-input-login]"),t=n.val();this.requestEmail(t,"request_password_reset")},resendConfirmation:function(){var n,t=this.$("[data-hull-input-login]");n=Hull.currentUser()?Hull.currentUser().email:t.val(),this.requestEmail(n,"request_confirmation_email")}},datasources:{validationStatus:function(){return this.loggedIn()&&this.api("me/validation_status")},currentUser:"me"},initialize:function(){this.sandbox.on("hull.auth.fail",function(n){this.alertMessage(n.message||n.reason)},this)},requestEmail:function(n,t){var a=this;/^\S+@\S+\.\S+$/i.test(n)?this.api("users/"+t,"post",{email:n}).then(function(){a.alertMessage("Email sent to "+n+". Check your inbox !")},function(t){if(429==t.status&&t.retry_after){var e=Math.round(t.retry_after/60);a.alertMessage("An email has already been sent to "+n+". Please check your inbox. You will be able to retry in "+e+" minutes ("+t.retry_after+" seconds)")}}):this.alertMessage("You must provide a valid email: "+n)},beforeRender:function(n){if(n.validationStatus&&!n.validationStatus.valid&&n.validationStatus.validations){n.validationErrors={};for(var t in n.validationStatus.validations)n.validationStatus.validations[t]||(n.validationErrors[t]=!0)}},alertMessage:function(n){var t=this.$("[data-hull-alert-message]");n?(t.html(n),t.show()):t.hide()}});