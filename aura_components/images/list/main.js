this.Hull=this.Hull||{},this.Hull.templates=this.Hull.templates||{},this.Hull.templates._default=this.Hull.templates._default||{},Hull.templates._default["images/list/list"]=function(i,e,s,t,a){function r(i){var e,s="";return s+='\n    <small>You need to sign in.</small>\n    <div data-hull-component="login/button@hull" data-hull-provider="'+v((e=i&&i.authorized,e=null==e||e===!1?e:e.provider_name,typeof e===m?e.apply(i):e))+'"></div>\n'}function n(i,e){var t,a="";return a+="\n  ",t=s.unless.call(i,(t=i&&i.authorized,null==t||t===!1?t:t.permissions),{hash:{},inverse:f.program(6,l,e),fn:f.program(4,o,e),data:e}),(t||0===t)&&(a+=t),a+="\n"}function o(){return"\n    You need to give permissions to show these images.\n    <a class='btn' data-hull-action=\"authorize\">Authorize</a>\n  "}function l(i,e){var t,a="";return a+='\n    <div class="hull-images">\n      ',t=s["if"].call(i,i&&i.images,{hash:{},inverse:f.program(10,d,e),fn:f.program(7,h,e),data:e}),(t||0===t)&&(a+=t),a+="\n    </div>\n  "}function h(i,e){var t,a="";return a+='\n        <ul class="media-list">\n          ',t=s.each.call(i,i&&i.images,{hash:{},inverse:f.noop,fn:f.program(8,u,e),data:e}),(t||0===t)&&(a+=t),a+="\n        </ul>\n      "}function u(i,e){var t,a,r="";return r+='\n            <li class="media">\n              <a class="pull-left" href="#">\n                <img src="',(a=s.picture)?t=a.call(i,{hash:{},data:e}):(a=i&&i.picture,t=typeof a===m?a.call(i,{hash:{},data:e}):a),r+=v(t)+'" alt="',(a=s.name)?t=a.call(i,{hash:{},data:e}):(a=i&&i.name,t=typeof a===m?a.call(i,{hash:{},data:e}):a),r+=v(t)+'" class=\'media-object\'>\n              </a>\n              <div class="media-body">\n                <h4 class="media-heading">',(a=s.name)?t=a.call(i,{hash:{},data:e}):(a=i&&i.name,t=typeof a===m?a.call(i,{hash:{},data:e}):a),r+=v(t)+"</h4>\n              </div>\n            </li>\n          "}function d(){return'\n        <div class="alert">\n          <p>No images for the moment.</p>\n        </div>\n      '}this.compilerInfo=[4,">= 1.0.0"],s=this.merge(s,i.helpers),a=a||{};var c,p="",m="function",v=this.escapeExpression,f=this;return c=s.unless.call(e,(c=e&&e.authorized,null==c||c===!1?c:c.provider),{hash:{},inverse:f.program(3,n,a),fn:f.program(1,r,a),data:a}),(c||0===c)&&(p+=c),p+="\n\n"},Hull.component("images/list@hull",{type:"Hull",templates:["list"],options:{id:"me",provider:"hull",limit:10,format:"small",scope:"user_photos"},refreshEvents:["model.hull.me.change"],initialize:function(){this.me=this.sandbox.data.api.model("me"),this.provider=this.options.provider,this.id=this.options.id||"me"},actions:{authorize:function(){"facebook"===this.provider?this.sandbox.login("facebook",{scope:this.options.scope}).then(this.sandbox.util._.bind(function(){this.render()},this)):this.sandbox.login(this.provider,{}).then(this.sandbox.util._.bind(function(){},this))}},datasources:{authorized:function(){return this.isAuthorized(this.provider)},images:function(){var i=this.sandbox.data.deferred(),e=this,s=this.sandbox.util._.reduce(this.me.get("identities"),function(i,e){return i[e.provider]=e,i},{});return this.loggedIn()[this.provider]||"hull"===this.provider&&(this.loggedIn()||"me"!==this.id)?this.request(this.provider,s,this.options).then(this.sandbox.util._.bind(function(s){var t=this.sandbox.util._.bind(this.serializers[e.provider],this,s,this.options),a=t().slice(0,this.options.limit);i.resolve(a)},this)):i.resolve([]),i.promise()}},isAuthorized:function(i){var e=this.sandbox.data.deferred(),s=this,t={provider_name:i,provider:!1,permissions:!1};if("hull"===i){t.permissions=!0;var a=this.loggedIn()||"me"!==this.id;t.provider=a;var r=this.authServices();r&&r.length?(t.provider_name=r[0],e.resolve(t)):e.reject(new Error("No auth provider for this app"))}else this.loggedIn()[i]?(t.provider=!0,"facebook"===i?this.hasFacebookPermissions(s.options.scope,t,e):(t.permissions=!0,e.resolve(t))):(t.provider=!1,e.resolve(t));return e.promise()},hasFacebookPermissions:function(i,e,s){"use strict";var t=this.sandbox.util._;this.api({provider:"facebook",path:"me/permissions"}).then(function(a){t.isString(i)&&(i=i.replace(" ","").split(",")),t.isArray(i)&&t.intersection(t.keys(a.data[0]),i).length==i.length&&(e.permissions=!0),s.resolve(e)})},request:function(i){"use strict";var e,s;switch(i){case"hull":e=this.id+"/images",s={per_page:this.options.limit};break;case"facebook":e={provider:"facebook",path:this.id+"/photos/uploaded"},s={};break;case"instagram":e={provider:"instagram",path:"users/"+("me"===this.id?"self":this.id)+"/media/recent"},s={per_page:this.options.limit}}return this.api(e,s)},serializers:{hull:function(i,e){"use strict";var s=this.sandbox;return this.sandbox.util._.map(i,function(i){return{provider:"hull",name:i.name,picture:s.helpers.imageUrl(i.id,e.format)}})},facebook:function(i,e){"use strict";var s="source";switch(e.format){case"small":case"thumb":case"square":s="picture";break;case"medium":case"large":case"original":s="source"}return this.sandbox.util._.map(i.data,function(i){return{provider:"facebook",name:i.from.name,picture:i[s],uid:i.id}})},instagram:function(i,e){var s="low_resolution";switch(e.format){case"small":case"thumb":case"square":s="thumbnail";break;case"medium":s="standard_resolution";break;case"large":case"original":s="standard_resolution"}return this.sandbox.util._.map(i,function(i){var e="";return i&&i.caption&&(e=i.caption.text),{provider:"instagram",name:e,picture:i.images[s].url,uid:i.id}})}}});