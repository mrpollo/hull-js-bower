this.Hull=this.Hull||{},this.Hull.templates=this.Hull.templates||{},this.Hull.templates._default=this.Hull.templates._default||{},Hull.templates._default["conversations/thread/form"]=function(a,n,e,t,s){function i(a,n){var t,s,i,c="";return c+='\n    <form data-hull-item="form">\n      <div class=\'media\'>\n        <div class="pull-left">\n          <img class="media-object img-rounded" src="'+v((t=a&&a.me,t=null==t||t===!1?t:t.picture,typeof t===m?t.apply(a):t))+'" alt="'+v((t=a&&a.me,t=null==t||t===!1?t:t.name,typeof t===m?t.apply(a):t))+'" width="70" height="70">\n        </div>\n        <div class="media-body">\n          <textarea name=\'body\' class="input-block-level" rows="3" placeholder="Send a message... "></textarea>\n          <button data-hull-action="message" data-hull-id="'+v((t=a&&a.conversation,t=null==t||t===!1?t:t.id,typeof t===m?t.apply(a):t))+'" class="btn btn-primary">\n            ',t=e["if"].call(a,a&&a.isNew,{hash:{},inverse:g.program(4,o,n),fn:g.program(2,l,n),data:n}),(t||0===t)&&(c+=t),c+="\n            ",i={hash:{},inverse:g.noop,fn:g.program(6,r,n),data:n},(s=e.me)?t=s.call(a,i):(s=a&&a.me,t=typeof s===m?s.call(a,i):s),e.me||(t=b.call(a,t,{hash:{},inverse:g.noop,fn:g.program(6,r,n),data:n})),(t||0===t)&&(c+=t),c+="\n          </button>\n\n          ",t=e["if"].call(a,(t=a&&a.conversation,null==t||t===!1?t:t.notification_enabled),{hash:{},inverse:g.noop,fn:g.program(8,d,n),data:n}),(t||0===t)&&(c+=t),c+="\n        </div>\n      </div>\n    </form>\n  "}function l(){return"Send"}function o(){return"Reply"}function r(a,n){var t,s,i="";return i+="as ",(s=e.name)?t=s.call(a,{hash:{},data:n}):(s=a&&a.name,t=typeof s===m?s.call(a,{hash:{},data:n}):s),i+=v(t)}function d(a,n){var t,s="";return s+="\n          ",t=e["if"].call(a,(t=a&&a.conversation,null==t||t===!1?t:t.notification_enabled_user),{hash:{},inverse:g.program(11,h,n),fn:g.program(9,c,n),data:n}),(t||0===t)&&(s+=t),s+="\n          "}function c(){return'\n          <div class="pull-right">\n            <a class="btn-link" data-hull-action="disableNotifications">\n              <span class="text-success">\n                Notifications enabled\n              </span>\n            </a>\n          </div>\n          '}function h(){return'\n          <div class="pull-right">\n            <a class="btn-link muted" data-hull-action="enableNotifications">\n              <span class="muted">\n                Notifications muted\n              </span>\n            </a>\n          </div>\n          '}function p(){return'\n    <div data-hull-component="login/button@hull"></div>\n  '}this.compilerInfo=[4,">= 1.0.0"],e=this.merge(e,a.helpers),s=s||{};var u,f="",m="function",v=this.escapeExpression,g=this,b=e.blockHelperMissing;return f+='<div class="well">\n  ',u=e["if"].call(n,n&&n.loggedIn,{hash:{},inverse:g.program(13,p,s),fn:g.program(1,i,s),data:s}),(u||0===u)&&(f+=u),f+="\n</div>\n"},Hull.templates._default["conversations/thread/participants"]=function(a,n,e,t,s){function i(a,n){var t,s,i="";return i+='\n  <img data-toggle="tooltip" title="',(s=e.name)?t=s.call(a,{hash:{},data:n}):(s=a&&a.name,t=typeof s===r?s.call(a,{hash:{},data:n}):s),i+=d(t)+'" class="img-rounded" src="',(s=e.picture)?t=s.call(a,{hash:{},data:n}):(s=a&&a.picture,t=typeof s===r?s.call(a,{hash:{},data:n}):s),i+=d(t)+'" alt="',(s=e.name)?t=s.call(a,{hash:{},data:n}):(s=a&&a.name,t=typeof s===r?s.call(a,{hash:{},data:n}):s),i+=d(t)+'" width="36" height="36">\n'}this.compilerInfo=[4,">= 1.0.0"],e=this.merge(e,a.helpers),s=s||{};var l,o="",r="function",d=this.escapeExpression,c=this,h=e.blockHelperMissing;return l=n&&n.conversation,l=null==l||l===!1?l:l.participants,l=typeof l===r?l.apply(n):l,l=h.call(n,l,{hash:{},inverse:c.noop,fn:c.program(1,i,s),data:s}),(l||0===l)&&(o+=l),o+="\n"},Hull.templates._default["conversations/thread/thread"]=function(a,n,e,t,s){function i(){return'\n  <div class="alert alert-error">Unable to retrieve the conversation</div>\n'}function l(a,n){var t,s="";return s+="\n  ",t=e["if"].call(a,a&&a.conversation,{hash:{},inverse:_.program(17,m,n),fn:_.program(4,o,n),data:n}),(t||0===t)&&(s+=t),s+="\n"}function o(a,n){var s,i,l,o="";return o+='\n    <div class="hull-conversation">\n      <div class="hull-conversation__header">\n        <h3>\n          <span class="pull-right muted"><small>started '+y((i=e.fromNow||a&&a.fromNow,l={hash:{},data:n},i?i.call(a,(s=a&&a.conversation,null==s||s===!1?s:s.created_at),l):N.call(a,"fromNow",(s=a&&a.conversation,null==s||s===!1?s:s.created_at),l)))+"</small></span>\n          "+y((s=a&&a.conversation,s=null==s||s===!1?s:s.name,typeof s===b?s.apply(a):s))+"\n        </h3>\n        ",s=e["if"].call(a,(s=a&&a.conversation,null==s||s===!1?s:s.isDeleteable),{hash:{},inverse:_.noop,fn:_.program(5,r,n),data:n}),(s||0===s)&&(o+=s),o+='\n        <div class="hull-conversation__participants text-right">\n          ',s=_.invokePartial(t["conversations/thread/participants"],"conversations/thread/participants",a,e,t,n),(s||0===s)&&(o+=s),o+='\n        </div>\n      </div>\n      <hr />\n      <div class="row-fluid">\n          ',l={hash:{},inverse:_.program(7,d,n),fn:_.noop,data:n},(i=e.isAscending)?s=i.call(a,l):(i=a&&a.isAscending,s=typeof i===b?i.call(a,l):i),e.isAscending||(s=w.call(a,s,{hash:{},inverse:_.program(7,d,n),fn:_.noop,data:n})),(s||0===s)&&(o+=s),o+="\n\n          ",s=e["if"].call(a,a&&a.messages,{hash:{},inverse:_.noop,fn:_.program(9,c,n),data:n}),(s||0===s)&&(o+=s),o+="\n\n          ",l={hash:{},inverse:_.program(15,f,n),fn:_.noop,data:n},(i=e.messages)?s=i.call(a,l):(i=a&&a.messages,s=typeof i===b?i.call(a,l):i),e.messages||(s=w.call(a,s,{hash:{},inverse:_.program(15,f,n),fn:_.noop,data:n})),(s||0===s)&&(o+=s),o+="\n\n          ",s=e["if"].call(a,a&&a.isAscending,{hash:{},inverse:_.noop,fn:_.program(7,d,n),data:n}),(s||0===s)&&(o+=s),o+="\n      </div>\n    </div>\n  "}function r(a){var n,e="";return e+='\n          <button data-hull-action="deleteConvo" data-hull-id="'+y((n=a&&a.conversation,n=null==n||n===!1?n:n.id,typeof n===b?n.apply(a):n))+'" class="btn btn-link text-error pull-right">\n            Delete conversation\n          </button>\n        '}function d(a,n){var s,i="";return i+="\n            ",s=_.invokePartial(t["conversations/thread/form"],"conversations/thread/form",a,e,t,n),(s||0===s)&&(i+=s),i+="\n          "}function c(a,n){var t,s,i,l="";return l+='\n            <ul class="media-list hull-messages__list">\n              ',i={hash:{},inverse:_.noop,fn:_.program(10,h,n),data:n},(s=e.messages)?t=s.call(a,i):(s=a&&a.messages,t=typeof s===b?s.call(a,i):s),e.messages||(t=w.call(a,t,{hash:{},inverse:_.noop,fn:_.program(10,h,n),data:n})),(t||0===t)&&(l+=t),l+="\n            </ul>\n          "}function h(a,n){var t,s,i,l="";return l+='\n              <li class="media" data-hull-message-id="',(s=e.id)?t=s.call(a,{hash:{},data:n}):(s=a&&a.id,t=typeof s===b?s.call(a,{hash:{},data:n}):s),l+=y(t)+'">\n                <div class="pull-left">\n                  <img class="media-object img-rounded" src="'+y((t=a&&a.actor,t=null==t||t===!1?t:t.picture,typeof t===b?t.apply(a):t))+'" alt="'+y((t=a&&a.actor,t=null==t||t===!1?t:t.name,typeof t===b?t.apply(a):t))+'" width="50" height="50">\n                </div>\n                <div class="media-body">\n                  <div class="pull-right text-right">\n                    <small class="muted">'+y((s=e.fromNow||a&&a.fromNow,i={hash:{},data:n},s?s.call(a,a&&a.updated_at,i):N.call(a,"fromNow",a&&a.updated_at,i)))+"</small>\n                    ",t=e["if"].call(a,a&&a.isNew,{hash:{},inverse:_.noop,fn:_.program(11,p,n),data:n}),(t||0===t)&&(l+=t),l+='\n                  </div>\n                  <h5 class="media-heading">'+y((t=a&&a.actor,t=null==t||t===!1?t:t.name,typeof t===b?t.apply(a):t))+'</h5>\n                  <div class="hull-messages__body">\n                    ',s=e.autoLink||a&&a.autoLink,i={hash:{},data:n},t=s?s.call(a,a&&a.body,i):N.call(a,"autoLink",a&&a.body,i),(t||0===t)&&(l+=t),l+='\n                  </div>\n                  <div class="hull-messages__actions">\n                      ',t=e["if"].call(a,a&&a.isDeletable,{hash:{},inverse:_.noop,fn:_.program(13,u,n),data:n}),(t||0===t)&&(l+=t),l+="\n                  </div>\n                </div>\n              </li>\n              "}function p(){return'\n                    <br>\n                    <small class="text-success">NEW</small>\n                    '}function u(a,n){var t,s,i="";return i+='\n                        <small>\n                          <a href="#" class=\'link\' data-hull-action="deleteMsg" data-hull-id="',(s=e.id)?t=s.call(a,{hash:{},data:n}):(s=a&&a.id,t=typeof s===b?s.call(a,{hash:{},data:n}):s),i+=y(t)+'">Delete</a>\n                        </small>\n                      '}function f(){return'\n            <div class="alert alert-info">\n              No messages started yet\n            </div>\n          '}function m(){return'\n    <div class="alert alert-info">No conversation selected</div>\n  '}this.compilerInfo=[4,">= 1.0.0"],e=this.merge(e,a.helpers),t=this.merge(t,a.partials),s=s||{};var v,g="",b="function",y=this.escapeExpression,_=this,N=e.helperMissing,w=e.blockHelperMissing;return v=e["if"].call(n,(v=n&&n.errors,null==v||v===!1?v:v.conversation),{hash:{},inverse:_.program(3,l,s),fn:_.program(1,i,s),data:s}),(v||0===v)&&(g+=v),g+="\n"},Hull.component("conversations/thread@hull",{templates:["thread","form","participants"],refreshEvents:["model.hull.me.change"],actions:{message:"message",deleteMsg:"deleteMsg",enableNotifications:"enableNotifications",disableNotifications:"disableNotifications","delete":"delete"},options:{focus:!0,order:"desc"},datasources:{conversation:function(){return this.options.id?this.api(this.options.id):void 0},messages:function(){return this.options.id?this.api(this.options.id+"/messages",this.getMessagesParams()):void 0}},getMessagesParams:function(){var a={};return this.options.limit&&(a.per_page=this.options.limit),a},initialize:function(){this.sandbox.on("hull.conversation.select",function(a){this.options.id=a,this.render()},this)},beforeRender:function(a,n){var e=this.sandbox.util._;return a.isAscending="desc"!=this.options.order,a.conversation?(a.participants=a.conversation.participants,this.loggedIn()&&(a.conversation.isDeletable=a.conversation.actor&&a.conversation.actor.id==a.me.id,e.each(a.messages,function(n){n.isDeletable=n.actor&&n.actor.id===this.data.me.id;var e=a.conversation.last_read;return e instanceof Object&&(e=e[this.data.me.id]),n.isNew=!n.isMe&&(e?n.id>e:!0),n.isMe=n.actor&&n.actor.id===a.me.id,n},this),a.isFollowing=e.find(a.participants,function(n){return n.id==a.me.id},this),a.isNew=!(a.messages&&a.messages.length>0))):(a.newConvo=!0,a.errors=n),"desc"!==this.options.order&&(a.messages=a.messages.reverse()),a},afterRender:function(a){var n=this;(this.options.focus||this.focusAfterRender)&&(this.$el.find("input,textarea").focus(),this.focusAfterRender=!1);var e=this.$el.find('[data-toggle="tooltip"]');e&&e.tooltip&&e.tooltip(),setTimeout(function(){n.options.id&&a.messages&&n.api(n.options.id+"/messages","put")},2e3)},toggleLoading:function(a){var n=a.toggleClass("is-loading"),e=n.find(".btn");e.attr("disabled",!e.attr("disabled"));var t=n.find("textarea");t.attr("disabled",!t.attr("disabled"))},message:function(a,n){a.preventDefault();var e=this,t=this.$el.find("[data-hull-item='form']"),s=this.sandbox.dom.getFormData(t),i=s.body;if(this.toggleLoading(t),i&&i.length>0){var l=n.data.id,o={body:i};this.api(l+"/messages","post",o).then(function(){e.toggleLoading(t),e.render()})}else this.toggleLoading(t)},deleteMsg:function(a,n){a.preventDefault();var e=n.data.id,t=n.el.addClass("is-removing").parents('[data-hull-message-id="'+e+'"]');this.api(e,"delete").then(function(){t.remove()})},"delete":function(a,n){event.preventDefault();var e=n.data.id,t=this;this.api(e,"delete").then(function(){t.sandbox.emit("hull.conversation.thread.delete",{id:e,cid:t.cid})})},disableNotifications:function(){var a=this;this.api(this.options.id+"/notifications","delete").then(function(){a.render()})},enableNotifications:function(){var a=this;this.api(this.options.id+"/notifications","put").then(function(){a.render()})}});