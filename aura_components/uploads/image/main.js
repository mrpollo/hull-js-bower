this.Hull=this.Hull||{},this.Hull.templates=this.Hull.templates||{},this.Hull.templates._default=this.Hull.templates._default||{},Hull.templates._default["uploads/image/file"]=function(e,i,a,o,n){return this.compilerInfo=[4,">= 1.0.0"],a=this.merge(a,e.helpers),n=n||{},'<span class="btn btn-success fileinput-button">\n  <h4>Add files...</h4>\n  <input type="file" name="file" accept="image/*" capture="camera">\n</span>\n'},Hull.templates._default["uploads/image/upload"]=function(e,i,a,o,n){function l(e,i){var n,l,s,r="";return r+='\n  <form action="',(l=a.url)?n=l.call(e,{hash:{},data:i}):(l=e&&e.url,n=typeof l===f?l.call(e,{hash:{},data:i}):l),r+=h(n)+'" method="post" enctype="multipart/form-data" class="hull-upload">\n\n    ',l=a.key_value||e&&e.key_value,s={hash:{},inverse:c.noop,fn:c.program(2,t,i),data:i},n=l?l.call(e,e&&e.params,s):m.call(e,"key_value",e&&e.params,s),(n||0===n)&&(r+=n),r+='\n\n    <div class="hull-upload__dropzone dropzone well hidden-phone hidden-phone-tablet">\n      <b>Drop an image here</b>\n    </div>\n\n    <input type="hidden" name="Filename" value=""/>\n    <input type="hidden" name="Content-Type" value=""/>\n    <input type="hidden" name="name" value=""/>\n\n    <div class="hull-upload__filebutton fileupload-buttonbar">\n        ',n=c.invokePartial(o["uploads/image/file"],"uploads/image/file",e,a,o,i),(n||0===n)&&(r+=n),r+='\n    </div>\n\n    <div class="fileupload-progress fade">\n      <div data-hull-progress class="progress-success progress-striped active" role="progressbar" aria-valuemin="0" aria-valuemax="100">\n        <div data-hull-progress-bar class="bar" style="width:0%;"></div>\n      </div>\n      <div class="progress-extended">&nbsp;</div>\n    </div>\n\n\n    <div class=\'error\'></div>\n    <div class=\'filescontainer\'></div>\n  </form>\n'}function t(e,i){var o,n,l="";return l+='\n      <input type="hidden" name="',(n=a.key)?o=n.call(e,{hash:{},data:i}):(n=e&&e.key,o=typeof n===f?n.call(e,{hash:{},data:i}):n),l+=h(o)+'" value="',(n=a.value)?o=n.call(e,{hash:{},data:i}):(n=e&&e.value,o=typeof n===f?n.call(e,{hash:{},data:i}):n),l+=h(o)+'"/>\n    '}function s(){return"\n  No storage backend configured. As an admin, please configure one.\n"}this.compilerInfo=[4,">= 1.0.0"],a=this.merge(a,e.helpers),o=this.merge(o,e.partials),n=n||{};var r,d,p,u="",f="function",h=this.escapeExpression,c=this,m=a.helperMissing,v=a.blockHelperMissing;return p={hash:{},inverse:c.noop,fn:c.program(1,l,n),data:n},(d=a.upload_policy)?r=d.call(i,p):(d=i&&i.upload_policy,r=typeof d===f?d.call(i,p):d),a.upload_policy||(r=v.call(i,r,{hash:{},inverse:c.noop,fn:c.program(1,l,n),data:n})),(r||0===r)&&(u+=r),u+="\n",p={hash:{},inverse:c.program(4,s,n),fn:c.noop,data:n},(d=a.upload_policy)?r=d.call(i,p):(d=i&&i.upload_policy,r=typeof d===f?d.call(i,p):d),a.upload_policy||(r=v.call(i,r,{hash:{},inverse:c.program(4,s,n),fn:c.noop,data:n})),(r||0===r)&&(u+=r),u+="\n"},Hull.component("uploads/image@hull",{type:"Hull",templates:["upload","file"],require:["fileupload"],requiredOptions:["storage"],options:{storage:"hull"},fileTypes:{images:/(\.|\/)(gif|jpe?g|png)$/i,videos:/(\.|\/)(mov|mkv|mpg|wmv|mp4|m4v)$/i},fileProcessors:{images:[{action:"load",fileTypes:/^image\/(gif|jpeg|png)$/,maxFileSize:2e7},{action:"resize",maxWidth:1440,maxHeight:900},{action:"save"}]},uploader_events:{fileuploadadd:"onAdd",fileuploadadded:"onAdded",fileuploadalways:"onAlways",fileuploadchange:"onChange",fileuploadcompleted:"onCompleted",fileuploaddestroy:"onDestroy",fileuploaddestroyed:"onDestroyed",fileuploaddone:"onDone",fileuploaddragover:"onDragover",fileuploaddrop:"onDrop",fileuploadfail:"onFail",fileuploadfailed:"onFailed",fileuploadfinished:"onFinished",fileuploadpaste:"onPaste",fileuploadprogress:"onProgress",fileuploadprogressall:"onProgressAll",fileuploadsend:"onSend",fileuploadsent:"onSent",fileuploadstart:"onStart",fileuploadstarted:"onStarted",fileuploadstop:"onStop",fileuploadstopped:"onStopped",fileuploadsubmit:"onSubmit"},uploader_options:{autoUpload:!0,maxNumberOfFiles:1,maxFileSize:5e6,minFileSize:0,dropZone:".dropzone",type:"POST"},selectStoragePolicy:function(){var e,i=[],a=this.options.storage;this.sandbox.config.services.storage&&(i=this.sandbox.util._.keys(this.sandbox.config.services.storage));var o=i.length;if(1===o)e=i[0];else if(o>1){if(!a)throw new TypeError("You must specify a storage policy.");if(!i.hasOwnProperty(a))throw new TypeError("Unknown storage policy: ",a);e=i[a]}return this.sandbox.config.services.storage[e]},beforeRender:function(e){return e.upload_policy=this.selectStoragePolicy(),e},afterRender:function(){var e=this.sandbox.util._;this.form=this.$el.find("form");var i=e.defaults(this.uploader_options,{dataType:"xml",url:this.form.attr("action"),dropZone:this.$el.find(this.uploader_options.dropZone),acceptFileTypes:this.fileTypes.images});this.form.fileupload(i),this.uploader=this.form.data("fileupload"),this.dropzone=this.$el.find(this.uploader_options.dropZone);var a=this.sandbox.emit,o=this.form;e.each(this.uploader_events,function(e,i){var n=i.replace(/^fileupload/,"");o.on(i,function(e,i){a("hull.upload.image."+n,{event:e,data:i})})}),e.each(this.uploader_events,function(i,a){this[i]&&this.form.on(a,e.bind(this[i],this))},this)},start:function(){this.form.fileupload("send",this.upload_data)},cancel:function(){},"delete":function(){},onSuccess:function(){this.dropzone.find("b").text("Thanks !"),this.dropzone.removeClass("dropzone")},onDrop:function(){this.dropzone.find("b").text("Thanks !"),this.dropzone.removeClass("dropzone")},onDragOver:function(){this.dropzone.addClass("dragover"),clearTimeout(this.dragOverEffect);var e=this;this.dragOverEffect=setTimeout(function(){e.dropzone.removeClass("dragover")},100)},onAdd:function(e,i){var a=this.$el.find('[name="key"]'),o=a.val();return a.val(o.replace("${filename}","/"+i.files[0].name)),this.$el.find('[name="Filename"]').val(i.files[0].name),this.$el.find('[name="name"]').val(i.files[0].name),this.$el.find('[name="Content-Type"]').val(i.files[0].type),this.upload_data=i},onSend:function(){this.$el.find(".progress").fadeIn()},onSubmit:function(){this.toggleDescription()},toggleDescription:function(){var e=this.$el.find("[name=description]");e.is(":disabled")?(e.removeAttr("disabled"),e.val("")):(this.description=e.val()||void 0,this.$el.find("[name=description]").attr("disabled","disabled"))},onProgress:function(e,i){this.$el.find(".bar").css("width",i.percent+"%")},onFail:function(){this.$el.find(".error").text("Error :#{data.errorThrown}")},onDone:function(e,i){this.$el.find("[data-hull-progress]").fadeOut(300,function(){}),this.$el.find("[data-hull-progress-bar]").css("width",0),this.onUploadDone(i)},onUploadDone:function(e){var i=this.sandbox.util._;i.map(e.files,i.bind(function(e){e.url=this.fileUrl(e.name),e.description=this.description;var i=this.options.id||"me";this.api(i+"/images","post",{description:e.description,source_url:e.url,name:e.name}).then(function(e){this.sandbox.emit("hull.uploads.image.finished",e)}.bind(this))},this)),this.toggleDescription(),this.uploader.options.maxNumberOfFiles++},multipleUpload:function(){return!1},fileUrl:function(e){var i=this.selectStoragePolicy();return encodeURI(i.url+i.params.key.replace("${filename}","/"+e))},initialize:function(){}});