this.Hull=this.Hull||{},this.Hull.templates=this.Hull.templates||{},this.Hull.templates._default=this.Hull.templates._default||{},Hull.templates._default["comments/list/form"]=function(t,e,n,a,l){function i(t){var e,n="";return n+='\n    <form>\n      <div class=\'media\'>\n        <div class="pull-left">\n          <img class="media-object img-rounded" src="'+m((e=t&&t.me,e=null==e||e===!1?e:e.picture,typeof e===d?e.apply(t):e))+'" alt="'+m((e=t&&t.me,e=null==e||e===!1?e:e.name,typeof e===d?e.apply(t):e))+'" width="50" height="50">\n        </div>\n        <div class="media-body">\n          <textarea name=\'description\' class="input-block-level" rows="3" placeholder="Leave a comment..."></textarea>\n          <div>\n            <button data-hull-action="comment" disabled class="btn btn-small btn-primary">Post as '+m((e=t&&t.me,e=null==e||e===!1?e:e.name,typeof e===d?e.apply(t):e))+'</button>\n            <div class=\'pull-right\'>\n              <small>\n                <a href="#" data-hull-action="logout" class="link">Logout</a>\n              </small>\n            </div>\n          </div>\n        </div>\n      </div>\n    </form>\n  '}function s(){return'\n    <div data-hull-component="login/button@hull"></div>\n  '}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,t.helpers),l=l||{};var o,r="",d="function",m=this.escapeExpression,c=this;return r+='<div class="well">\n  ',o=n["if"].call(e,e&&e.loggedIn,{hash:{},inverse:c.program(3,s,l),fn:c.program(1,i,l),data:l}),(o||0===o)&&(r+=o),r+="\n</div>\n"},Hull.templates._default["comments/list/list"]=function(t,e,n,a,l){function i(t,e){var a,l="";return l+='\n  <ul class="media-list hull-comments__list">\n    ',a=n.each.call(t,t&&t.comments,{hash:{},inverse:g.noop,fn:g.program(2,s,e),data:e}),(a||0===a)&&(l+=a),l+="\n  </ul>\n"}function s(t,e){var a,l,i,s="";return s+='\n      <li class="media" data-hull-comment-id="',(l=n.id)?a=l.call(t,{hash:{},data:e}):(l=t&&t.id,a=typeof l===u?l.call(t,{hash:{},data:e}):l),s+=p(a)+'">\n        <div class="pull-left">\n          <img class="media-object img-rounded" src="'+p((a=t&&t.user,a=null==a||a===!1?a:a.picture,typeof a===u?a.apply(t):a))+'" alt="'+p((a=t&&t.user,a=null==a||a===!1?a:a.name,typeof a===u?a.apply(t):a))+'" width="50" height="50">\n        </div>\n        <div class="media-body">\n          <h4 class="media-heading">'+p((a=t&&t.user,a=null==a||a===!1?a:a.name,typeof a===u?a.apply(t):a))+' <small class="muted"> â€¢ '+p((l=n.fromNow||t&&t.fromNow,i={hash:{},data:e},l?l.call(t,t&&t.updated_at,i):f.call(t,"fromNow",t&&t.updated_at,i)))+'</small></h4>\n          <div class="hull-comments__description">\n            ',(l=n.description)?a=l.call(t,{hash:{},data:e}):(l=t&&t.description,a=typeof l===u?l.call(t,{hash:{},data:e}):l),s+=p(a)+'\n          </div>\n          <div class="hull-comments__actions">\n              ',a=n["if"].call(t,t&&t.isDeletable,{hash:{},inverse:g.noop,fn:g.program(3,o,e),data:e}),(a||0===a)&&(s+=a),s+='\n              <small>\n                <a href="#" class=\'link text-error\' data-hull-action="flag" data-hull-id="',(l=n.id)?a=l.call(t,{hash:{},data:e}):(l=t&&t.id,a=typeof l===u?l.call(t,{hash:{},data:e}):l),s+=p(a)+'">Inappropriate?</a>\n              </small>\n          </div>\n        </div>\n      </li>\n    '}function o(t,e){var a,l,i="";return i+='\n                <small>\n                  <a href="#" class=\'link\' data-hull-action="delete" data-hull-id="',(l=n.id)?a=l.call(t,{hash:{},data:e}):(l=t&&t.id,a=typeof l===u?l.call(t,{hash:{},data:e}):l),i+=p(a)+'">Delete</a>\n                </small>\n              '}function r(){return'\n  <div class="alert alert-info">\n    No comments for the moment\n  </div>\n'}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,t.helpers),a=this.merge(a,t.partials),l=l||{};var d,m,c,h="",u="function",p=this.escapeExpression,f=n.helperMissing,g=this,v=n.blockHelperMissing;return d=g.invokePartial(a["comments/list/form"],"comments/list/form",e,n,a,l),(d||0===d)&&(h+=d),h+="\n\n"+p((d=e&&e.comments,d=null==d||d===!1?d:d.length,typeof d===u?d.apply(e):d))+" comments\n",d=n["if"].call(e,e&&e.comments,{hash:{},inverse:g.noop,fn:g.program(1,i,l),data:l}),(d||0===d)&&(h+=d),h+="\n\n",c={hash:{},inverse:g.program(5,r,l),fn:g.noop,data:l},(m=n.comments)?d=m.call(e,c):(m=e&&e.comments,d=typeof m===u?m.call(e,c):m),n.comments||(d=v.call(e,d,{hash:{},inverse:g.program(5,r,l),fn:g.noop,data:l})),(d||0===d)&&(h+=d),h+="\n"},Hull.component("comments/list@hull",{templates:["list","form"],refreshEvents:["model.hull.me.change"],requiredOptions:["id"],events:{'keyup [name="description"]':"checkButtonStatus"},actions:{comment:"postComment","delete":"deleteComment",flag:"flagItem"},options:{focus:!1,perPage:10,page:1},datasources:{comments:":id/comments"},initialize:function(){var t={};this.options.startPage?t.page=this.options.startPage:t.skip=this.options.skip||0,this.sandbox.on("hull.comments."+this.options.id+".**",function(){this.render()},this),t.limit=this.options.limit||this.options.perPage,this.query=t},checkButtonStatus:function(){var t=!this.$find('[name="description"]').val();this.$find('[data-hull-action="comment"]').attr("disabled",t)},beforeRender:function(t){return this.sandbox.util._.each(t.comments,function(e){return e.isDeletable=e.user&&e.user.id===t.me.id,e},this),t},afterRender:function(){(this.options.focus||this.focusAfterRender)&&(this.$el.find("input,textarea").focus(),this.focusAfterRender=!1),this.checkButtonStatus()},deleteComment:function(t,e){t.preventDefault();var n=e.data.id,a=e.el.addClass("is-removing").parents('[data-hull-comment-id="'+n+'"]');this.api(n,"delete").then(function(){a.remove()})},toggleLoading:function(){this.$el.toggleClass("is-loading"),this.$find("input,textarea,button").attr("disabled",this.$el.hasClass("is-loading"))},postComment:function(t){t.preventDefault();var e=this,n=this.$find("form"),a=this.sandbox.dom.getFormData(n);a.description&&a.description.length>0&&(this.toggleLoading(),this.api(this.options.id+"/comments","post",a).then(function(t){e.sandbox.emit("hull.comments."+e.options.id+".added",t),e.toggleLoading(),e.focusAfterRender=!0,e.render()},function(){e.$el.find("input,textarea").focus(),e.toggleLoading()}))},flagItem:function(t,e){t.preventDefault();var n=e.data.id,a=confirm("Do you want to report this content as inappropriate ?");a&&this.sandbox.flag(n)}});